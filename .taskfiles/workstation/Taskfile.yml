---
version: "3"

tasks:
  krew:
    desc: Set up Krew plugins for kubectl
    cmds:
      - |
        if ! mise exec -- krew version >/dev/null 2>&1; then
          echo "âŒ krew not found. Please run 'mise install' first to install krew."
          exit 1
        fi

        PLUGINS="cert-manager cnpg browse-pvc node-shell"

        for plugin in $PLUGINS; do
          if mise exec -- krew list | grep -q "^$plugin\s"; then
            echo "âœ… $plugin already installed, skipping"
          else
            echo "ğŸ“¦ Installing kubectl plugin: $plugin"
            mise exec -- krew install "$plugin" || echo "âš ï¸  Failed to install $plugin, continuing..."
          fi
        done

        echo "ğŸ‰ Krew plugin installation complete!"
    preconditions:
      - which kubectl
