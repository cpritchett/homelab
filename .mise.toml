# mise configuration for hypyr homelab
# https://mise.jdx.dev

[tools]
conftest = "0.65.0"
flux2 = "2.7.5"
gitleaks = "8.30.0"
helm = "3.19.2"
jq = "1.8.1"
k9s = "0.50.16"
kubectl = "1.35.0"
kustomize = "5.8.0"
kyverno = "1.16.1"   # Kubernetes admission policies (CLI)
talosctl = "1.12.2"
task = "3.45.5"
yq = "4.49.2"
ytt = "0.52.2"

[env]
# Environment variables
PROJECT_ROOT = "{{cwd}}"

[tasks."hooks:install"]
description = "Configure git hooks to use .githooks/"
run = "git config core.hooksPath .githooks && find .githooks -type f -maxdepth 1 -exec chmod +x {} +"

[tasks."security:scan:staged"]
description = "Scan staged changes for secrets/PII (same as pre-commit hook)"
run = "gitleaks protect --staged --redact --config .gitleaks.toml"

[tasks."security:scan:repo"]
description = "Full repo scan for secrets/PII"
run = "gitleaks detect --source . --redact --config .gitleaks.toml"

[tasks."security:test"]
description = "Validate gitleaks catches synthetic fixtures and ignores safe content"
run = "bash scripts/security-test.sh"

[tasks."security:scan:test"]
description = "Alias for security:test"
run = "bash scripts/security-test.sh"
