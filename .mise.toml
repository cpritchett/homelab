# mise configuration for hypyr homelab
# https://mise.jdx.dev

[tools]
conftest = "0.65.0"
gitleaks = "8.30.0"
jq = "1.8.1"
opentofu = "1.9.0"
task = "3.45.5"
yq = "4.49.2"

[env]
# Environment variables
PROJECT_ROOT = "{{cwd}}"

[tasks."hooks:install"]
description = "Configure git hooks to use .githooks/"
run = "git config core.hooksPath .githooks && find .githooks -type f -maxdepth 1 -exec chmod +x {} +"

[tasks."security:scan:staged"]
description = "Scan staged changes for secrets/PII (same as pre-commit hook)"
run = "gitleaks protect --staged --redact --config .gitleaks.toml"

[tasks."security:scan:repo"]
description = "Full repo scan for secrets/PII"
run = "gitleaks detect --source . --redact --config .gitleaks.toml"

[tasks."security:test"]
description = "Validate gitleaks catches synthetic fixtures and ignores safe content"
run = "bash scripts/security-test.sh"

[tasks."security:scan:test"]
description = "Alias for security:test"
run = "bash scripts/security-test.sh"
