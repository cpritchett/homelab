# yaml-language-server: $schema=https://goauthentik.io/blueprints/schema.json
# Aggregate outpost assignment — assigns ALL forward-auth providers to the
# embedded outpost. Prefixed with zz- so it runs after individual provider
# blueprints have been applied.
#
# Forward auth is for services with no built-in auth or where SSO gating
# is preferred. Services with their own auth that support OIDC natively
# (Forgejo, Woodpecker) use OAuth2/OIDC provider integration instead.
#
# When adding a new service:
#   1. Create forward-auth-<service>.yaml (provider + application)
#   2. Add the provider to the list below
#   3. Add Caddy forward_auth labels to the service's compose file
version: 1

metadata:
  name: "Outpost Assignments"
  labels:
    blueprints.goauthentik.io/instantiate: "true"

entries:
  - model: authentik_outposts.outpost
    state: present
    identifiers:
      name: "authentik Embedded Outpost"
    attrs:
      name: "authentik Embedded Outpost"
      type: "proxy"
      config:
        authentik_host: "https://auth.in.hypyr.space"
      providers:
        # Platform services
        - !Find [authentik_providers_proxy.proxyprovider, [name, prometheus-forward-auth]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, loki-forward-auth]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, homepage-forward-auth]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, grafana-forward-auth]]
        # Media — core stack
        - !Find [authentik_providers_proxy.proxyprovider, [name, sonarr-forward-auth]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, radarr-forward-auth]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, prowlarr-forward-auth]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, sabnzbd-forward-auth]]
        # Media — support stack
        - !Find [authentik_providers_proxy.proxyprovider, [name, bazarr-forward-auth]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, tautulli-forward-auth]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, maintainerr-forward-auth]]
        # Media — torrent stack
        - !Find [authentik_providers_proxy.proxyprovider, [name, qbittorrent-forward-auth]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, cross-seed-forward-auth]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, autobrr-forward-auth]]
        # Media — enrichment stack
        - !Find [authentik_providers_proxy.proxyprovider, [name, titlecards-forward-auth]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, posterizarr-forward-auth]]
