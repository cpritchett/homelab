apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: volsync-rules
  namespace: observability
spec:
  groups:
    - name: volsync.backups
      rules:
        - alert: VolSyncReplicationFailures
          expr: |
            rate(volsync_replication_source_total[15m]) > 0
            and (
              (rate(volsync_replication_source_success_total[15m]) /
               rate(volsync_replication_source_total[15m])) < 0.9
            )
          for: 15m
          labels:
            severity: warning
          annotations:
            summary: VolSync replication failures
            description: "VolSync success rate below 90% over 15m for source {{ $labels.name }}"
        - alert: VolSyncStaleBackup
          expr: |
            (time() - max_over_time(volsync_replication_source_last_sync_timestamp_seconds[1h])) > 6*3600
          for: 30m
          labels:
            severity: warning
          annotations:
            summary: VolSync backups stale
            description: "No VolSync backup in >6h for source {{ $labels.name }}"
