# ADR-0025: Strict Markdown Governance & Artifact Location

**Status**: Accepted  
**Date**: 2026-01-25  
**Deciders**: cpritchett (repo owner)

---

## Context

Agents and developers frequently create unnecessary `.md` files (summary documents, extra documentation, checklist files) scattered throughout the repository. These create:

- **Noise**: Harder to find actual documentation
- **Maintenance burden**: Unclear which docs are canonical vs. transient
- **Complexity**: Developers unsure where documentation belongs
- **Governance violations**: Random files not validated by CI gates

The repository already has a clear structure:
- `docs/adr/` - Architecture decisions (append-only, numbered)
- `docs/` - General documentation
- `ops/runbooks/` - Operational procedures
- `specs/*/` - Feature specifications (new with speckit)
- `requirements/*/` - Domain requirements

Yet agents and developers still create arbitrary `.md` files (e.g., `plan.md` in spec dirs, `summary.md` in feature dirs, `notes.md` in random places).

---

## Decision

**All markdown files MUST be justified and located per the allowlist below. Arbitrary markdown creation is prohibited and blocked by CI gates.**

### Markdown File Allowlist

**Root-level** (`/`):
- ✅ `README.md` - Repository overview
- ✅ `CONTRIBUTING.md` - Contribution guidelines
- ✅ `CLAUDE.md` - Agent instructions (if needed)
- ✅ `agents.md` - Non-authoritative agent entrypoint
- ✅ `.github/copilot-instructions.md` - Copilot context
- ✅ `.github/PULL_REQUEST_TEMPLATE.md` - GitHub PR template
- ✅ `.github/agents/speckit.*.agent.md` - Speckit agent definitions
- ✅ `.github/prompts/speckit.*.prompt.md` - Speckit prompts
- ✅ `.gemini/*.md` - Style guides, reference docs
- ❌ All others prohibited (no arbitrary `SUMMARY.md`, `PLAN.md`, etc.)

**Under `docs/`**:
- ✅ `docs/adr/ADR-NNNN-*.md` - Numbered architecture decisions (append-only)
- ✅ `docs/*.md` - General documentation (e.g., `policy-enforcement.md`, `glossary.md`)
- ✅ `docs/governance/*.md` - Governance procedures
- ✅ `docs/operations/*.md` - Operational guidance
- ❌ No other subdirectories with markdown (no `docs/summaries/`, `docs/notes/`, etc.)

**Under `ops/`**:
- ✅ `ops/CHANGELOG.md` - Single file, append-only
- ✅ `ops/README.md` - Ops overview
- ✅ `ops/runbooks/*.md` - Operational procedures
- ❌ All others prohibited

**Under `requirements/`**:
- ✅ `requirements/*/spec.md` - Domain specifications (DNS, ingress, storage, etc.)
- ✅ `requirements/*/checks.md` - Validation criteria
- ❌ No `plan.md`, `summary.md`, `notes.md`, or other variants

**Under `specs/`** (speckit feature branches):
- ✅ `specs/NNN-*/spec.md` - Feature specification (mandatory, auto-generated)
- ✅ `specs/NNN-*/plan.md` - Implementation plan (Phase 2 output only)
- ✅ `specs/NNN-*/research.md` - Phase 0 research (auto-generated by speckit)
- ✅ `specs/NNN-*/data-model.md` - Phase 1 design (auto-generated by speckit)
- ✅ `specs/NNN-*/quickstart.md` - Phase 1 setup guide (auto-generated by speckit)
- ✅ `specs/NNN-*/contracts/` - API contracts, schemas (Phase 1 output)
- ✅ `specs/NNN-*/checklists/*.md` - Quality checklists (mandatory)
- ✅ `specs/NNN-*/tasks.md` - Task breakdown (Phase 2 output, auto-generated)
- ❌ All others prohibited (no `summary.md`, `notes.md`, `howto.md`, etc.)

**Under `infra/`**:
- ✅ `infra/README.md` - Overview
- ✅ `infra/<domain>/README.md` - Domain overviews
- ❌ All others prohibited

**Under `kubernetes/`**:
- ✅ `kubernetes/README.md` - Overview only
- ❌ All others prohibited

**Under `talos/`**:
- ✅ `talos/README.md` - Overview only
- ✅ `talos/spec.md` - Talos configuration specification
- ✅ `talos/checks.md` - Validation criteria
- ❌ All others prohibited

**Under `bootstrap/`**:
- ✅ `bootstrap/README.md` - Overview only
- ✅ `bootstrap/spec.md` - Bootstrap specification
- ✅ `bootstrap/checks.md` - Validation criteria
- ❌ All others prohibited

---

## Rationale

1. **Clarity**: Developers know exactly which docs are authoritative
2. **Maintenance**: Easier to find and update documentation
3. **Governance**: CI gates can enforce the allowlist automatically
4. **Agent Safety**: Agents know they cannot create arbitrary files
5. **Consistency**: All feature work follows same structure (speckit-generated files only)

The allowlist is exhaustive and conservative. If a new document type is needed, it requires:
1. ADR amendment (change this decision)
2. CI gate update
3. PR review & approval

---

## Consequences

### For Agents

- ❌ Cannot create summary documents, notes, or transient files
- ✅ Must use pre-approved speckit workflows (`/speckit.plan`, `/speckit.tasks`)
- ✅ Speckit auto-generates all necessary documentation files in correct locations

### For Developers

- ❌ Cannot create feature branches with arbitrary markdown
- ✅ Must follow speckit structure for feature work
- ✅ Governance automation now catches markdown violations

### For CI/CD

- ✅ New gate: `scripts/enforce-markdown-allowlist.sh`
- ✅ Blocks PRs with disallowed markdown files
- ✅ Clear error message shows allowed paths and files

---

## Implementation

### 1. Update Invariants (`contracts/invariants.md`)

Add markdown governance section:

```markdown
## Markdown File Invariants

1. **Markdown files must be on allowlist**
   - Only files explicitly listed in ADR-0025 are permitted
   - Root-level `*.md` is exhaustively enumerated
   - Subdirectories have strict path/name patterns
   - Violations block merge via CI gate

2. **No arbitrary documentation**
   - No `summary.md`, `notes.md`, `plan.md` outside `specs/NNN-*/`
   - No `README.md` outside approved directories
   - No undocumented markdown files anywhere
```

### 2. Create CI Gate (`scripts/enforce-markdown-allowlist.sh`)

Checks all committed `.md` files against allowlist. Blocks PR if violations found.

### 3. Update Existing Gates

- `enforce-root-structure.sh` - Already enforces root `.md` files; verify alignment
- `run-all-gates.sh` - Add new markdown gate to full validation suite

---

## Related

- **ADR-0005**: Agent Governance Procedures
- **ADR-0018**: GitOps Structure Refactor
- **ADR-0024**: Speckit Workflow (non-canonical)
- **Invariants**: `contracts/invariants.md` - Markdown File Invariants (added)

---

## Approved By

- **cpritchett** (repo owner)
- **Date Approved**: 2026-01-25
